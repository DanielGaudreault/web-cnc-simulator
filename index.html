<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebCNC Simulator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">WebCNC Simulator</div>
            <div class="header-controls">
                <button onclick="loadGCodeExample('square')">Square Pocket</button>
                <button onclick="loadGCodeExample('circle')">Circle</button>
                <button onclick="loadGCodeExample('grid')">Grid Pattern</button>
                <button onclick="loadGCodeExample('spiral')">Spiral</button>
            </div>
        </div>

        <div class="sidebar">
            <div class="control-group">
                <div class="control-label">Workpiece Setup</div>
                <input type="number" id="workpieceWidth" placeholder="Width (mm)" value="100">
                <input type="number" id="workpieceHeight" placeholder="Height (mm)" value="100">
                <input type="number" id="workpieceDepth" placeholder="Depth (mm)" value="20">
                <button onclick="createWorkpiece()">Create Workpiece</button>
            </div>

            <div class="control-group">
                <div class="control-label">Tool Setup</div>
                <select id="toolType">
                    <option value="endmill">End Mill (6mm)</option>
                    <option value="ballnose">Ball Nose (8mm)</option>
                    <option value="drill">Drill (4mm)</option>
                </select>
                <input type="number" id="toolDiameter" placeholder="Tool Diameter (mm)" value="6">
                <input type="number" id="feedRate" placeholder="Feed Rate (mm/min)" value="1000">
            </div>

            <div class="control-group">
                <div class="control-label">Simulation Controls</div>
                <div class="control-buttons">
                    <button onclick="startSimulation()" class="play-btn">▶ Play</button>
                    <button onclick="pauseSimulation()" class="pause-btn">⏸ Pause</button>
                    <button onclick="resetSimulation()" class="stop-btn">⏹ Stop</button>
                </div>
                <input type="range" id="simulationSpeed" min="1" max="10" value="5">
                <div class="control-label">Speed: <span id="speedValue">5</span>x</div>
            </div>

            <div class="control-group">
                <div class="control-label">View Controls</div>
                <div class="control-buttons">
                    <button onclick="toggleToolpath()">Toggle Toolpath</button>
                    <button onclick="toggleWorkpiece()">Toggle Workpiece</button>
                    <button onclick="resetView()">Reset View</button>
                </div>
            </div>
        </div>

        <div class="viewer">
            <canvas id="viewport"></canvas>
            <div class="coordinates" id="coordinates">X: 0.00 Y: 0.00 Z: 0.00</div>
            <div class="simulation-info" id="simulationInfo">Ready</div>
            
            <!-- 3D Axes Controller -->
            <div class="axes-controller" id="axesController">
                <div class="axes-label">View Controls</div>
                <canvas id="axesViewport"></canvas>
                <div class="axes-instructions">
                    Drag to rotate view<br>
                    Scroll to zoom
                </div>
            </div>
        </div>

        <div class="tools-panel">
            <div class="control-group">
                <div class="control-label">Simulation Stats</div>
                <div id="stats">
                    <div>Time: <span id="simTime">0:00</span></div>
                    <div>Operations: <span id="opCount">0</span></div>
                    <div>Material Removed: <span id="materialRemoved">0%</span></div>
                    <div>Tool Position: <span id="toolPos">X0 Y0 Z0</span></div>
                </div>
            </div>

            <div class="control-group">
                <div class="control-label">Current Operation</div>
                <div id="currentOp">None</div>
            </div>

            <div class="control-group">
                <div class="control-label">Machine State</div>
                <div id="machineState">
                    <div>Units: MM</div>
                    <div>Mode: Absolute</div>
                    <div>Plane: XY</div>
                    <div>Feed: 1000 mm/min</div>
                </div>
            </div>
        </div>

        <div class="gcode-panel">
            <div class="panel-header">
                G-code Editor
                <div class="editor-controls">
                    <button onclick="formatGCode()">Format</button>
                    <button onclick="clearGCode()">Clear</button>
                    <button onclick="validateGCode()">Validate</button>
                </div>
            </div>
            <textarea class="gcode-editor" id="gcodeEditor" spellcheck="false" placeholder="Enter your G-code here..."></textarea>
        </div>
    </div>

    <!-- Load Three.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="gcode-examples.js"></script>
    <script src="simulator.js"></script>
    
    <script>
        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', () => {
            // Load default G-code example
            loadGCodeExample('square');
            
            // Initialize simulator after Three.js is loaded
            if (typeof THREE !== 'undefined') {
                setTimeout(() => {
                    simulator = new CNCSimulator();
                    createWorkpiece();
                }, 100);
            }
        });
    </script>
</body>
</html>
